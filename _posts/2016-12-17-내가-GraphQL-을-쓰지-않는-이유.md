---
layout: post
title: '내가 GraphQL 을 쓰지 않는 이유'
author: 이재연
image: '/static/covers/graphqlhub-logo.png'
draft: false
date: 2016-12-17
---

**주의! 커리어상 겨우 2년차 백엔드 개발자의 글입니다. 또한 아래의 의견들은 매우 주관적입니다.**

저는 백엔드 개발자이기도 하면서 프론트엔드 개발자이고 또한 iOS 개발자입니다.

파트별로 불만은 항상 존재합니다. 비효율도 항상 존재합니다. 프론트엔드나 iOS 개발을 하면서 비효율을 많이 느꼈는데 특히 `HTTP 기반 API 콜을 어떻게 효율적으로 사용할 수 있는가` 는 항상 저를 고민에 빠지게 합니다. 또한 프론트엔드 기술들이 빠른속도로 발전하면서 `어떤 기술을 사용해야 하나` 도 마찬가지로 항상 고민이 됩니다. 그러던중 친구가 이 글의 주제인 `GraphQL` 스터디를 제안하였고, 이 과정을 통해 어떤것들을 느끼고 스스로 결론내렸는지 제 생각을 공유해보고자 합니다.

## 시작

우선 GraphQL 에 대해서 간략하게 설명을 해보자면...

GraphQL 은 엄밀하게 RESTful API 와 관계가 없습니다. GraphQL 은 [DSL](https://en.wikipedia.org/wiki/Domain-specific_language) 입니다. 새로운 쿼리 문법이죠. HTTP 와도 관계가 없습니다. 단순히 쿼리 문법이며, 서버와 클라이언트는 이 문법을 통해 기존에는 관리하기 힘들었던 nested 한 요청과 응답을 편하게 받을수 있게됩니다. 아래 예시를 확인해주세요.

#### RESTful API 예시

```
Request:
GET /products/1?fields=%22id%22%2C%20%22name%22%2C%20%22sellers%22 HTTP/1.1
Host: api.ne-go.kr
Accept: application/json

Response:
{
    "id": 1346463,
    "name": "BN-NBMD543013IVORY",
    "sellers": [{
        "delivery_fee": null,
        "image": "http://imageurl",
        "info": "뉴발란스 자켓 /BN-NBMD543013IVORY/UNI 우븐 플리스",
        "mall_name": "11번가",
        "old_price": null,
        "price": 136040,
        "url": "http://linkurl"
    }]
}
```



#### GraphQL 예시 (HTTP 통신을 사용)

```
Request:
POST /graphql HTTP/1.1
Host: api.ne-go.kr
Content-Type: application/json
Accept: application/json

query {
  products(id: 1) {
    id
    name
    sellers {
      info
      price
    }
  }
}

Response:
{
    "data": {
        "id": 1346463,
        "name": "BN-NBMD543013IVORY",
        "sellers": [
            {
                "info": "뉴발란스 자켓 /BN-NBMD543013IVORY/UNI 우븐 플리스",
                "price": 136040
            }
        ]
    }
}
```

## 처음엔...

서버 개발자가 RESTful 한 API 를 만들어두면, 클라이언트 개발자는 해당 API 를 보다 잘 이해할 수 있습니다.

하지만.. 복잡하고 많은 정보들이 들어가있는 `뷰`를 그려야 한다면 ???

API 를 한번... 다른 API 를 또 한번... 다른 API 를 또 한번... 여기에 순차 요청까지 필요하다면...

뷰를 보여주기도 전에 네트워크 요청단에서 너무 나도 많은 시간을 소모하게됩니다.

이 부분에서 GraphQL 은 너무나도 매력있게 느껴졌습니다. 과도하게 많아질 수 있는 호출들을 한방에 해결할 수 있고, 초기 로딩이 빨라지면서 UX 에도 좋은 영향을 줄것이고, 새로운 모델이 추가되거나 기존 모델이 수정되지 않는 한, 뷰가 바뀌어도 서버쪽에 추가적인 요청 없이 입맛대로 요청이 가능합니다.

개꿀......

## Relay 의 등장
[Relay](https://facebook.github.io/relay/) 는 페이스북에서 만든, [React](https://facebook.github.io/react/) 와 조합해서 쓰는 라이브러리입니다.

이놈을 적용하기 위해선... 꽤나 많은 작업이 필요합니다. 서버의 스키마도 변경해줘야하고 모델들이 죄다 `Node` 로 바뀌면서 다른 클라이언트에서도 모델의 형태가 바껴야합니다. 그리고 무엇보다 적용하기가 어렵고 이놈때문에 바뀌는 코드의 양이 엄청납니다.

## 갈등
Relay 의 문제 뿐만이 아닙니다. iOS 나 Android 환경에서는 GraphQL 을 정식으로 지원하지 않습니다. 기본적으로 GraphQL 은 커뮤니티 드리븐 방식이기 때문에 해당 언어에 구현체가 없거나 안정적이지 않거나 사용하기 불편하면 답이 없습니다. 대부분의 커뮤니티는 js 쪽에 형성이 되어있어서 다른 언어들은 구현체가 있어도 프로덕션에서의 사용은 아직 조심스럽습니다. 지원이 된다고 하면 이제 클라이언트 개발자는 `GraphQL 을 배운 후`에 `쿼리를 작성` 해야합니다. 배워야할 기술이 하나 더 생기게됩니다. 과연 모든 클라이언트 개발자가 이를 받아들일 수 있을지 모르겠네요.

이번에는 서버쪽에서 생각을 좀 더 해볼까요? 기존에 ORM 을 사용하고 있을 경우 스키마와 연결이 꽤나 어렵습니다. 파이썬의 경우에는 커뮤니티에서 ORM 객체와 같이 사용할 수 있도록 익스텐션 라이브러리를 만들어놔서 그나마 낫지만, 타 비주류 언어는 처참한 수준입니다. 저는 요즘 Go-lang 을 사용하는데 정말 처참합니다...

## 결론 or 합리화
만약 이러한 문제들이 모두 해결된다면? => js 밖에 없습니다.

현재로서 서버는 nodejs 웹은 react + relay 앱은 react native + relay 로 구성을 하면 꽤나 잘 쓸수가 있지만 하나라도 기술 스택이 다르다면, 게다가 비주류 언어라면 아직은 이르다는 생각이 드네요.